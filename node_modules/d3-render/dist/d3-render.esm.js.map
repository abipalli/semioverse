{"version":3,"file":"d3-render.esm.js","sources":["../src/getNamespace.ts","../src/render.ts","../src/index.ts"],"sourcesContent":["/**\n * Work out what element type based on element name\n * Most commonly 'svg' or 'html'\n */\nfunction getNamespace(elementName) {\n  // SVG Element list from\n  // https://developer.mozilla.org/en-US/docs/Web/SVG/Element\n  if (\n    [\n      // 'a',\n      'animate',\n      'animateMotion',\n      'animateTransform',\n      'circle',\n      'clipPath',\n      'color-profile',\n      'defs',\n      'desc',\n      'discard',\n      'ellipse',\n      'feBlend',\n      'feColorMatrix',\n      'feComponentTransfer',\n      'feComposite',\n      'feConvolveMatrix',\n      'feDiffuseLighting',\n      'feDisplacementMap',\n      'feDistantLight',\n      'feDropShadow',\n      'feFlood',\n      'feFuncA',\n      'feFuncB',\n      'feFuncG',\n      'feFuncR',\n      'feGaussianBlur',\n      'feImage',\n      'feMerge',\n      'feMergeNode',\n      'feMorphology',\n      'feOffset',\n      'fePointLight',\n      'feSpecularLighting',\n      'feSpotLight',\n      'feTile',\n      'feTurbulence',\n      'filter',\n      'foreignObject',\n      'g',\n      'hatch',\n      'hatchpath',\n      'image',\n      'line',\n      'linearGradient',\n      'marker',\n      'mask',\n      'mesh',\n      'meshgradient',\n      'meshpatch',\n      'meshrow',\n      'metadata',\n      'mpath',\n      'path',\n      'pattern',\n      'polygon',\n      'polyline',\n      'radialGradient',\n      'rect',\n      // 'script',\n      'set',\n      'solidcolor',\n      'stop',\n      // 'style',\n      'svg',\n      'switch',\n      'symbol',\n      'text',\n      'textPath',\n      'title',\n      'tspan',\n      'unknown',\n      'use',\n      'view',\n    ].includes(elementName)\n  ) {\n    return 'svg';\n  }\n\n  return 'html';\n}\n\nexport default getNamespace;\n\n// Keep this HTML element list here in case it is better to search for\n// From https://developer.mozilla.org/en-US/docs/Web/HTML/Element\n// const htmlElements = [\n//   // Document Metadata\n//   'html',\n//   'base',\n//   'head',\n//   'link',\n//   'meta',\n//   'style',\n//   'title',\n//   // Sectioning Root\n//   'body',\n//   // Content Sectioning\n//   'address',\n//   'article',\n//   'aside',\n//   'footer',\n//   'header',\n//   'h1',\n//   'h2',\n//   'h3',\n//   'h4',\n//   'h5',\n//   'h6',\n//   'hgroup',\n//   'main',\n//   'nav',\n//   'section',\n//   // Text Content\n//   'blockquote',\n//   'dd',\n//   'div',\n//   'dl',\n//   'figcaption',\n//   'figure',\n//   'hr',\n//   'li',\n//   'main',\n//   'ol',\n//   'p',\n//   'pre',\n//   'ul',\n//   // Inline Text Semantics\n//   'a',\n//   'abbr',\n//   'b',\n//   'bdi',\n//   'bdo',\n//   'br',\n//   'cite',\n//   'code',\n//   'data',\n//   'dfn',\n//   'em',\n//   'i',\n//   'kbd',\n//   'mark',\n//   'q',\n//   'rb',\n//   'rp',\n//   'rt',\n//   'rtc',\n//   'ruby',\n//   's',\n//   'samp',\n//   'small',\n//   'span',\n//   'strong',\n//   'sub',\n//   'sup',\n//   'time',\n//   'u',\n//   'var',\n//   'wbr',\n//   // Image and Multimedia\n//   'area',\n//   'audio',\n//   'img',\n//   'map',\n//   'track',\n//   'video',\n//   'embed',\n//   'iframe',\n//   'object',\n//   'param',\n//   'picture',\n//   'source',\n//   // Scripting\n//   'canvas',\n//   'noscript',\n//   'script',\n//   // Demarcating Edits\n//   'del',\n//   'ins',\n//   // Table Content\n//   'caption',\n//   'col',\n//   'colgroup',\n//   'table',\n//   'tbody',\n//   'td',\n//   'tfoot',\n//   'th',\n//   'thead',\n//   'tr',\n//   // Forms\n//   'button',\n//   'datalist',\n//   'fieldset',\n//   'form',\n//   'input',\n//   'label',\n//   'legend',\n//   'meter',\n//   'optgroup',\n//   'option',\n//   'output',\n//   'progress',\n//   'select',\n//   'textarea',\n//   // Interactive Elements\n//   'details',\n//   'dialog',\n//   'menu',\n//   'summary',\n//   // Web Components\n//   'slot',\n//   'template',\n// ];\n","import * as d3 from 'd3-selection';\nimport 'd3-transition';\n\nimport getNamespace from './getNamespace';\n\ntype ElementDatum = {\n  append: string;\n  children?: ElementDatum[];\n  duration?: number | Function | TransitionObject;\n  delay?: number | Function | TransitionObject;\n  ease?: Function | TransitionObject;\n  style?: ElementStyles;\n  call?: Function;\n  [key: string]: ElementValue;\n};\n\ntype ElementValue = number | string | Function | object;\n\ntype ElementStyles = {\n  [key: string]: number | string | Function | object;\n};\n\ntype TransitionState = 'start' | 'enter' | 'update' | 'exit';\n\n// TODO: Causes type errors on style and children\ntype TransitionObject = {\n  start?: number | string | Function;\n  update?: number | string | Function;\n  enter: number | string | Function;\n  exit?: number | string | Function;\n};\n\n// type Selector = string | Node;\n\n// TODO: Consider incorporating element types from:\n// https://github.com/DefinitelyTyped/DefinitelyTyped/blob/master/types/react/index.d.ts\n\n/**\n * Using D3, this function renders elements based on declarative `data`, effectively replacing `select`, `append`, `data`, `join`, `enter`, `exit`, `transition` and more.\n * @param selector\n * @param data\n */\nexport default function render(selector, data: ElementDatum[]) {\n  // Crude way to check if `selector` is a D3 selection\n  if (typeof selector === 'object' && selector._groups && selector._parents) {\n    return renderSelection(selector, data);\n  }\n\n  const selection = d3.select(selector);\n\n  return renderSelection(selection, data);\n}\n\n/**\n * Recursively renders elements based on `data`, which can be deeply nested with the `children` key.\n */\nexport function renderSelection(selection, data: ElementDatum[], level = 0) {\n  if (!Boolean(data)) {\n    return selection;\n  }\n\n  return (\n    selection\n      // Cool way to select immediate children. (Totally didn't know you could do this)\n      .selectAll((_, i, nodes) => {\n        return nodes[i].children;\n      })\n      .data(\n        // Ensure all data elements are okay\n        data.filter(d => Boolean(d)),\n        (d, i) => d?.key || i\n      )\n      .join(\n        enter => {\n          return enter\n            .append(d => {\n              // Yes you saw that right. Append element based on 'append' key in data.\n              // Makes this whole function incredibly flexible\n              const namespace = getNamespace(d.append);\n\n              if (namespace === 'html') {\n                return document.createElement(d.append);\n              }\n\n              // https://stackoverflow.com/questions/51857699/append-shapes-dynamically-in-d3\n              return document.createElementNS(\n                // @ts-ignore\n                d3.namespace(namespace).space,\n                d.append\n              );\n            })\n            .each(function(d) {\n              const element = d3.select(this);\n\n              // Hook into things like selection.call(xAxis)\n              if (typeof d.call === 'function') {\n                d.call(element);\n              }\n\n              // Add initial attributes. For now, initial and exit values are the same\n              element.call(selection => addAttributes(selection, d, 'start'));\n\n              // Add HTML\n              if (d.html) {\n                element.html(d.html);\n              }\n\n              // Add events to element eg. onClick\n              element.call(selection => addEvents(selection, d));\n\n              // Add enter transitions\n              element.call(selection => addTransition(selection, d, 'enter'));\n\n              // element.call(selection =>\n              //   addEvents(selection, d, 'onTransition')\n              // );\n\n              // Recursively run again, passing in each child in selection\n              renderSelection(element, d.children, level + 1);\n            });\n        },\n        update => {\n          return update.each(function(d) {\n            const element = d3.select(this);\n            element.call(selection => addTransition(selection, d, 'update'));\n\n            renderSelection(element, d.children, level + 1);\n          });\n        },\n        exit => {\n          // Important magic sauce to exit all descendent children\n          exit.selectAll('*').each(exitTransition);\n\n          // NOTE: This doesn't seem to work, but '*' above will do for now\n          // exit.each(function(d) {\n          //   renderSelection(d3.select(this), d, level + 1);\n          // });\n\n          return exit.each(exitTransition);\n        }\n      )\n  );\n}\n\n/**\n * Add attributes to element node\n * @param selection\n * @param datum\n * @param state\n */\nfunction addAttributes(\n  selection,\n  datum: ElementDatum,\n  state: TransitionState\n  // node = null\n) {\n  // Assume anything other than key, text etc are attributes\n  const {\n    append,\n    call,\n    key,\n    text,\n    html,\n    style,\n    children,\n    duration,\n    delay,\n    ease,\n    ...attributes\n  } = datum;\n\n  // Rather than hand coding every attribute, we loop over the attributes object\n  for (const key in attributes) {\n    const attributeValue = attributes[key];\n    const value = getValue(attributeValue, state);\n    const isEvent = key.indexOf('on') === 0;\n\n    // Skip any on* events, we'll handle them in addEvents\n    if (!isEvent) {\n      selection.attr(keyToAttribute(key), value);\n    }\n  }\n\n  if (datum.text) {\n    selection.text(datum.text);\n  }\n\n  if (datum.style) {\n    selection = addStyles(selection, datum.style, state);\n  }\n\n  return selection;\n}\n\n/**\n * Add event to selection element\n * @param selection\n * @param datum\n */\nfunction addEvents(selection, datum, onPrefix = 'on') {\n  // Loop throught all keys in datum\n  for (const key in datum) {\n    const isEvent = key.indexOf(onPrefix) === 0;\n\n    // Only allow keys with on*\n    if (isEvent) {\n      const callback = datum[key];\n\n      // Check that the value is a callback function\n      if (typeof callback === 'function') {\n        const eventName = key.replace(onPrefix, '').toLowerCase();\n\n        selection.on(eventName, function(e, d) {\n          return callback(e, d);\n        });\n      }\n    }\n  }\n\n  return selection;\n}\n\n/**\n * Adds inline styles to the element\n * @param selection\n * @param styles\n * @param state\n */\nfunction addStyles(selection, styles: ElementStyles, state: TransitionState) {\n  for (const key in styles) {\n    const styleValue = styles[key];\n    const value = getValue(styleValue, state);\n\n    selection.style(camelToKebab(key), value);\n  }\n\n  return selection;\n}\n\n/**\n * Add transition to element, animating to a particular `state` by updating\n * selection with `addAttributes`\n * @param selection\n * @param datum\n * @param state\n */\nfunction addTransition(\n  selection,\n  datum: ElementDatum,\n  state: TransitionState = 'enter'\n) {\n  const duration = getValue(datum.duration, state);\n\n  if (!Boolean(datum)) {\n    return selection;\n  }\n\n  const delay = getValue(datum.delay, state) || 0;\n  const ease = getValue(datum.ease, state);\n\n  let transition = selection\n    .transition()\n    .delay(delay)\n    .duration(duration);\n\n  if (typeof ease === 'function') {\n    transition = transition.ease(t => ease(t));\n  }\n\n  if (state === 'exit') {\n    transition = transition.remove();\n  }\n\n  return selection\n    .transition(transition)\n    .call(selection => addAttributes(selection, datum, state));\n}\n\nfunction exitTransition(d) {\n  d3.select(this).call(selection => addTransition(selection, d, 'exit'));\n}\n\n/**\n * Get value from ElementDatum key, process and pass to selection.attr(),\n * selection.transition() or selection.style()\n * Every value can have an optional exit/enter value\n * We just check if value is an object eg. { exit: 0, enter: 100 }\n * @param value\n * @param state\n */\nfunction getValue(value, state: TransitionState): number | string | Function {\n  if (typeof value === 'object') {\n    const newValue = value[state];\n\n    // Default to `exit` if `start` value not available\n    // Assume that element will start the same way it exits\n    if (state === 'start' && isEmpty(newValue)) {\n      return value['exit'];\n    }\n\n    // Default to `enter` if `update` value not available\n    if (state === 'update' && isEmpty(newValue)) {\n      return value['enter'];\n    }\n\n    return newValue;\n  }\n\n  return value;\n}\n\n/**\n * Convert camelCase to kebab-case for JavaScript to HTML/CSS interop\n * @param string\n */\nfunction camelToKebab(string: string): string {\n  return string.replace(/([a-z0-9]|(?=[A-Z]))([A-Z])/g, '$1-$2').toLowerCase();\n}\n\n/**\n * Convert key to HTML attribute. Most keys will change from camel to kebab\n * case, except for certain SVG attributes.\n * @param string\n */\nfunction keyToAttribute(key: string): string {\n  if (\n    [\n      'allowReorder',\n      'attributeName',\n      'attributeType',\n      'autoReverse',\n      'baseFrequency',\n      'baseProfile',\n      'calcMode',\n      'clipPathUnits',\n      'contentScriptType',\n      'contentStyleType',\n      'diffuseConstant',\n      'edgeMode',\n      'externalResourceRequired',\n      'filterRes',\n      'filterUnits',\n      'glyphRef',\n      'gradientTransform',\n      'gradientUnits',\n      'kernelMatrix',\n      'kernelUnitLength',\n      'keyPoints',\n      'keySplines',\n      'keyTimes',\n      'lengthAdjust',\n      'limitingConeAngle',\n      'markerHeight',\n      'markerUnits',\n      'markerWidth',\n      'maskContentUnits',\n      'maskUnits',\n      'numOctaves',\n      'pathLength',\n      'patternContentUnits',\n      'patternTransform',\n      'patternUnits',\n      'pointsAtX',\n      'pointsAtY',\n      'pointsAtZ',\n      'preserveAlpha',\n      'preserveAspectRatio',\n      'primitiveUnits',\n      'referrerPolicy',\n      'refX',\n      'refY',\n      'repeatCount',\n      'repeatDur',\n      'requiredExtensions',\n      'requiredFeatures',\n      'specularConstant',\n      'specularExponent',\n      'spreadMethod',\n      'startOffset',\n      'stdDeviation',\n      'stitchTiles',\n      'surfaceScale',\n      'systemLanguage',\n      'tableValues',\n      'targetX',\n      'targetY',\n      'textLength',\n      'viewBox',\n      'xChannelSelector',\n      'yChannelSelector',\n      'zoomAndPan',\n    ].includes(key)\n  ) {\n    return key;\n  }\n\n  return camelToKebab(key);\n}\n\nfunction isEmpty(value) {\n  return value == null;\n}\n","import { selection } from 'd3-selection';\nimport render, { renderSelection } from './render';\n\n// TODO: Attempt at chaining render\nfunction chainedRender(data) {\n  return render(this, data);\n}\n\nselection.prototype.render = chainedRender;\n\nexport default render;\nexport { renderSelection };\n"],"names":["getNamespace","elementName","includes","render","selector","data","_groups","_parents","renderSelection","selection","d3","level","Boolean","selectAll","_","i","nodes","children","filter","d","key","join","enter","append","namespace","document","createElement","createElementNS","space","each","element","call","addAttributes","html","addEvents","addTransition","update","exit","exitTransition","datum","state","attributes","attributeValue","value","getValue","isEvent","indexOf","attr","keyToAttribute","text","style","addStyles","onPrefix","callback","eventName","replace","toLowerCase","on","e","styles","styleValue","camelToKebab","duration","delay","ease","transition","t","remove","newValue","isEmpty","string","chainedRender","prototype"],"mappings":"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"}